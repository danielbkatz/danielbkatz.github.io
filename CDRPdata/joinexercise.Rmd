---
title: 'Challenge: Merging data'
author: "Danny"
date: "6/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(xtable)
library(stargazer)
```

## Merging Data

Merging is a common task that needs to happen in typical data analytic tasks. Using the language of `SQL`, the tidyverse uses "joins" and "bind."

#### An example in which one might "join":  
I have data on students from a school district and data on the same students from the individual schools.  

1. Both data sets have unique information. For instance, the school district data has student demographic information and the school-level data has student grades. The school doesn't have demographic data and the district doesn't have grades. 

1. Both use the same ID for each student (so, John Doe has ID 110 in both data sets.)

1. I "join the data" by putting the two files together matching on the student ID. 

Ex:
```{r include=FALSE}
table1 <- tibble(ID = c("0101", "10101"), Name = c("Student1", "Student2"), Age = c("11", "12"))
```

```{r echo=FALSE}
table1
```

```{r include=FALSE, }

table2 <- tibble(ID = c("0101", "10101"), Grade = c("A", "B"))

```

```{r echo=FALSE}
table2
```
Then we use a "left_join" (not the by):

```{r}
mergedtable <- left_join(table1, table2, by = "ID")
```

```{r echo=FALSE}
mergedtable
```

If this had multiple years of grades across the top such as the table below, it would be referred to as non-tidy data (or simple, "wide data"). Typical wide-data formats include survey responses, in which each column across the top pertains to a particular item response.  

```{r echo=FALSE}
tibble(mergedtable, Grade2014 = "B", Grade2015="C", Grade2016 = "A")
```
## Binding rows

Another way to merge data is when you want to have "long data" or if you're simply adding cases. 

Let say you you don't want to have wide data, you want to have long data. You receive datasets from the school that looks like:

```{r echo=FALSE, results="asis"}
tableg1 <- tibble(ID = c("0101", "10101"), Grade = c("A", "B"), Year = "2012")
tableg2 <- tibble(ID = c("0101", "10101"), Grade = c("A", "C"), Year = "2013")

stargazer(tableg1, type="html", summary=F) 

stargazer(tableg2, type="html", summary=F) 
```
We have two data sets that have three of the same variable names. What we want to do is "bind_rows" to put them together.

```{r, results="asis"}
longdat <- bind_rows(tableg1, tableg2)
stargazer(longdat, type="html", summary=F) 
```

## Types of joins: Mutating Joins

There are many different types of ["mutating joins"](https://dplyr.tidyverse.org/reference/join.html). These joins keep columns from all the data frames you're using. 

+ `left_join()`: Keeps all rows on the left, x dataframe, while returning only matched rows from the `y` data frame. Columns from both dataframes are returned. Cases where there's an `X` but no match on `y` are returned with value NA. 

+ `Right_join()`: The same as a `left_join` but keeps all rows on right (`y`) instead of left. 

+ `full_join()`: Returns all columns and all cases from both `x` and `y`.

The image from [R for Data Science by Grolemund and Wickham](https://r4ds.had.co.nz/) is very helpful.





