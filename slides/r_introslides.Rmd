---
title: 'An Introduction to R: Data Cleaning, Wrangling, Visualizing, and Everything Else'
author: "Daniel Katz"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      titleSlideClass: ["center", "middle", "my-title"]
      highlightStyle: github
      highlightLines: true


---

class: middle
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```
```{r xaringan-themer, include = FALSE}
library(xaringanthemer)
mono_light(
  base_color = "#1c5253"
           )
```

# Introduction


```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(caTools)
library(gganimate)
library(knitr)
```

+ I'm a fourth year grad student at UCSB

+ Began chipping away at learning R about four years ago

+ It was really frustrating

+ After a major project or two, it became my preferred tool for most things data analysis

+ I don't expect you to be experts after this session, but I hope you know where to start!

+ Always remember that `R` is case sensitive, capitalization matters

---

class: center, middle

### What are you hoping to get out of thise course?
---

class: middle

### Teaching Philosophy/General Strategy


+ My goal is to get you up and running - doing is the best learning
  
+ I'm going with a `tidyverse` [_**first**_](http://varianceexplained.org/r/teach-tidyverse/) approach while mixing in foundations that I find unavoidable [_**Click to read more**_](http://varianceexplained.org/r/teach-tidyverse/)

+ I won't emphasize style/best practices except in a few cases

+ I think it's important to focus on ideas and functions!

+ For more on style/best practices, [_**click here**_](http://adv-r.had.co.nz/Style.html)

---

## General Outline
1. Intro: What is R? How should I think about R and Rstudio?

2. Some basic data structures (unavoidable foundation)

3. Data wrangling with the `tidyverse`

4. Data exploration
  + Visualization
  + Descriptive Statistics
  
5. Basic modelling in R

6. Other Help Resources

---


class: middle


# What is R?

+ R is a software and scripting language

+ Like any other language it has syntax (for now think, "rules" of language)

+ R comes with a variety of built-in functions

+ R is desiged for statistics, but you can do lots with it 
  + build websites
  + write documents in Latex
  + Create slides for presentations, etc.

---

# R and Packages
+ Think of `packages` as very specialized bundles of software. 
  + They're collections of functions developed by the "community"
  + For a full intro, [_**click here**_](https://www.datacamp.com/community/tutorials/r-packages-guide#what)

+ These packages have documentation if they're on `CRAN: The Comprehensive R Archive Network` (and even sometimes if they're not)  
  
+ You don't need all the packages!

+ For instance, the `psych` package is a built with tools commonly needed in the social sciences
  
---
## why the tidyverse?

The [_**tidyverse**_](https://www.tidyverse.org/packages/) is a suite of packages used to make data wrangling/cleaning, exploration, and, ultimately, modelling
  
  
```{r echo=FALSE}
packagsstab <- tibble(Package = c("dplyr", "ggplot2", "tidyr", "readr", "purrr", "tibble", "stringr", "forcats"), Description = c("for creating common, easy to use and remember verbs for basic data handling tasks", "for data visualization",  "for creating `tidy` data",  "for reading in 'rectangular' data of different formats",  "for really working with lots of data easily (for cleaning, computing variables, etc.)", "to make dealing with dataframes even easier. Dataframes will become tibbles in R", "for working with strings and doing a bit of text mining", "for handling factors in R"))

knitr::kable(xtable::xtable(packagsstab),  format = "html")
```

---

class: middle

## Packages, cont'd
+ When you `install.packages()`, R will search for a package on `CRAN` and download it to your computer

+ To see where it's downloaded, type `.libpaths()` and run this

+ Each time you start a new R session, you have to load a package via `library()` but you don't have to install, each time
---

class: middle

# Installing and Loading Packages 
Installs the package if it's not already installed:

`install.packages("psych")`

Loads the package so I can use the functions in the `psych` package"
`library(psych)`
---

class: middle 


## Installing and loading packages looks like this (note the quotes)

`install.packages("psych")`  
`library(psych)` 
---

class: middle
  
# Why do I like R?
+ It is quickly becoming the statistical language of choice in academic and non-academic circles  

--
  
+ Fast developing `R Packages` are making tasks more accessible to non-programmers like us
  
--
  
+ R allows for sharing code: we won't cover Github, but please [_**check it out**_](https://happygitwithr.com/rstudio-git-github.html)
  
--
  
+ R forces us to slow down and think

---

# It makes really cool data visualizations

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE, out.width='75%'}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_smooth(se = FALSE) +
  theme(legend.position = "bottom") +
  guides(colour = guide_legend(nrow = 1, override.aes = list(size = 4))) +
   labs(
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    colour = "Car type"
  )
```

---
 
```{r echo=FALSE, fig.align='center', message=FALSE}
ggplot(mpg, aes(x= factor(manufacturer),y=hwy))+geom_boxplot(aes(fill=manufacturer))+
theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

---

class: middle, center

## What's a Function?

---


```{r echo=FALSE, fig.align='center', out.width='90%'}
knitr::include_graphics("cyclists.gif")

```

---

# Other Forms of Functions?
$f(x)=sin(\theta)$ 

`f_angle <- sin(angle)` 
```{r makingdat, fig.align='center', message=FALSE, warning=FALSE, include=FALSE}
library(transformr)

angle <- matrix(seq(from = 1, to=20, by=.2),ncol=1)
output <- as.data.frame(sin(angle))
findat <- cbind(angle, output) %>% mutate(time1 = angle)

sinanimate <- ggplot(findat, aes(x=angle, y = V1)) + geom_line(size=.8, color="blue") + geom_point() +  labs(x="angle", y = "sin(angle)")+ transition_reveal(time1) + ease_aes('linear')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
animate(sinanimate, height = 500, width =900)
```

---
## What are some functions we use?
.pull-left[## How about a mean?
Let's say we have a vector, `x`, with five elements: `1,2,3,4,5`    

`x = [1,2,3,4,5]`

$mean(x)=\frac{1+2+3+4+5}{5}$ 

$mean(x) = 3$]

--
.pull-right[## `R` uses functions:
```{r echo=TRUE}
#Let's make a vector with 
#five elements

x <- c(1,2,3,4,5)

mean(x)
```
]
---

## There are also other forms of functions we use in computation
+ "Reading in" Data into R so we can explore or model

+ Linear Regression,`lm()` in R

+ Transforming Data in R:
```{r echo=FALSE}
knitr::include_graphics("gatheringdata.jpg")
```
From, [_**R for Data Science by Grolemund and Wickham**_](https://r4ds.had.co.nz)

---


class: middle


# Always Remind Yourself
  
+ The best way to learn R is to use it

+ Even when it's frustratingly slow, use R instead of something else
  
+ There are a lot of resources online to answer questions (Stack Exchange, Stack Overflow, Github)
  
+ Errors are good! Use the error output to guide your thinkingg (and Googling)

+ In other words, "failing fast" is really convenient

---

class: middle

## Open R Studio

1. Once open, click File (top left) > New Project > New Directory > New Project >Create Project as a Subdirectory of: click browse.
  
2. Choose where you'd like to put this session's R work. 

3. Go to the first box, `Directory Name` > Name this R project! (no spaces; It'll make your life easier)

4. Create Project.

---

class: middle


## Creating a "Script"

+ Scripts are RStudio's text editor. ***Work in Scripts***. They're saved text.  
  
+ Code in the console doesn't get saved 
  
+ The primary aim of working in scripts in being able to re-run your code
  
+ Don't rely on saving saved data, rely on being able to re-run your script as if you have no memory of what you had done before
---

## Creating a new script
In R studio, in the Project you created...
1. File > New File > R Script 
  + Or, ctrl+shft+N
  + Or, below file, hit the icon that looks like: 
```{r echo=FALSE}
knitr::include_graphics("createscript.jpg")
```
2. Save your script (File > Save)

3. Make sure it's saved in your project's directory

4. To run a line of code in a script, put your cursor on that line, and run it, via ctrl/cmd + enter. Or the `run` button in the top right of the script

5. There are multiple ways to run more than one line of code at a time
  + Highlight the relevant code, run
  + Or select the various options under "Run"

**Challenge** Figure out how to run a line of code in the console!
---

# Vocabulary
          
| R Word   | Translation
|----------|------------------
| Script   | Document containing code to be run
| Console  | Output Window/Printer (but you can also run code here)
| Environment| The place where things you create in R, live
| Working Directory| The folder where your current R session lives, where output files go

---

class: middle


# Open Up Rstudio
1. Find the `View` tab and change your RStudio session so it shows only the console
2. Change your R studio Session to look like it did before
3. Find the `Global Environment` (what's in there right now?)

---


# Operators in R
|Operation|Operator in R |Example|
|---------|------|-------|-------|
|Addition |`+` |`4+3`
|Subtraction|`-`| `4-3`
|Multiplication|`*`| `4*3`
|Exponentiation | `**`| `4**3`
|Division | `/`| `12/4`
|Matrix multiplication|`%*%`| `a %*% b`|

**Aside from the matrix multiplication, make sure all of these work in `R`** (use a script!)

---

class: middle


## Commenting

+ Commenting is essential to workflow. You may not remember why or what you were thinking or doing when looking at old code. 

+ R will recognize any line after `#` as a comment

For instance:

```{r}
# I ran this to see what would happen

factorial(4)

```

+ I recommend taking notes in an R script this way! 
  + Or open a text file (File > Text File). 
  + This won't run code, you can just take notes right in R studio
---
## Output
+ R `returns a value` in the `console`

+ It'll look like this:
```{r echo=FALSE}
knitr::include_graphics("output_slides.jpg")
```

***Challenge***: Order of operations: Run `(4+3)*(4-3)` and then `4+3*4-3` in the console (for experimentation). What happens?

---
## Variable Assignment
1. One of the most fundamental aspects of R (really any language) assigning `variables` or `objects`, giving something a name so you can store it and work with it in R.
  + R uses `<-` (shortcut for Windows: "alt" and "-" or in Mac: "option" and "-")

2. Now, we can store objects in R and work with the objects!

3. Note, none of this requires an external package, just through `base R`. For a nice base R cheat sheet, [_**Click**_](https://paulvanderlaken.files.wordpress.com/2017/08/base-r-cheetsheat.pdf)

--
 
For instance, run the code below:
```{r echo=TRUE}
x <- 2
```

```{r echo=TRUE}
#What's the value of y?
y <- x+2
```
---

class: middle 


## The Environment

+ In the right corner, under `Environment`, you should now see where R is "storing" what `x` and `y` and theire values.

+ The environment is also where we'll see what datasets, in R speak, `dataframes` that we have loaded or created, or other objects that we've assigned to variables


+If you don't assign something to a variable, it won't be stored
---
  

## Run the code below in a script

`x + y`

`x*y`

`x==y`

What happens?
--

```{r}
x + y

x*y

x==y
```

---
## Boolean Operators!

+ If you notice, R `x==y` yields, `FALSE`
+ `==` is a different type of operator

|Operation|Operator in R |Example|
|---------|------|-------|-------|
|Equality/Are they Equal? |`==` |`x==y`
|Not Equal |`!=` |`x!=y`
|Greater than or equal|`>=`| `x >= y`
|Less than or equal to|`<=`| `x <= y`
|Or | `|`| `x|y`
|And | `&`| `x & y`

---

## Data Structures
For individual values or vectors, R has a number of data types (not different than SPSS). We have a few ways of checking (for instance, numeric, character, factor, etc):

```{r}
# this will work on vectors as well
class(x)

is.numeric(x)
is.character(x)

isTRUE(x<2)


```
---
Class: Middle

## what's a Vector?
+ In R, it's basically anything that has more than one `element` in it.

+ It's just like a vector in math

```{r}

vector1 <- c(1, 3, 8, 9, 10**8)
vector1

```

---
## Check your Understanding

Run the following code:

`thisvector <- c("hello", "world", 4, 5)`

`thisvector`

`class(thisvector)`

**Challenge** 
1. What do you think `c()` does? (concat...)  

2. What `class` is `thisvector`?  

3. Strings, or in R speak, objects of class `character`, need to have double or single quotes around them. Any intuition why?  


---

## Check your Understanding

Run the following code:

`newvector <- c(1:5)`  
`extravector <- c(6:10)`    
`combinedvector <- newvector+extravector`   
`combinedvector`   

2. What does the `:` operator do?

3. what class is `newvector`?

--

```{r}
newvector <- c(1:5)
extravector <- c(6:10)
combinedvector <- newvector+extravector

combinedvector
```

---
### This is one of those necessary evils, so you know how R works
- To select individual elements, use `[2]` and the numeric position that you would like to extract. 

- For instance, run: `new2 <- newvector[c(2,3)]`

- This is also how one may pull out individual columns, rows, or specific rows and columns in a dataframe in R

- We can also get descriptives or compute across a vector, or specific vector elements

---

## How to Operate on Vectors (this is also true for dataframes)

+ Everything below are base R commands using base R functions

`sum(newvector)`  
**`sum(newvector[c(2,3)])`**  

`mean(newvector)`  
`sd(newvector)`  
`range(newvector)`  
**`summary(newvector)`**


```{r echo=FALSE}
sum(newvector)

sum(newvector[c(2,3)])

mean(newvector)

sd(newvector)

range(newvector)

summary(newvector)
```

---
### Enough Putzing about, Let's get to Data

+ The type of data structure you will most likely work with in R is the dataframe. Or, data.frame. 

+ Other common types of data structures:
  + `matrix`
  + `lists`
  + `arrays` 

--
+ An array is a general multidimensional data structure 
  + mindblowingly, a matrix that essentially has an x, y, and a z axis 
  
-- 

+ One can make lists of matrices or dataframes, and lists can be IN, dataframes
  + For instance, sometimes, you want to do the same thing to a number of dataframes.
  + If you put them in a list, you have a method for doing this very easily (we'll see later)
  
---
## Getting data sets in to R with the `readr` package
+ The first challenge: getting data into R

+ R needs a path (where the file that contains the data is)

+ R needs a command to read in the data

+ We're going to use the [_**`readr`**_](https://readr.tidyverse.org/) package to handle most file types

+ However, the `foreign` package and `haven` can handle files from SAS, SPSS, STATA (and probably others)

  + You don't need SPSS, SAS, or STATA to read data into R

---

## First, things first
+ Download the data!

+ The data today is a publically accessible dataset from the [_**California Department of Education**_](https://www.cde.ca.gov/ds/sd/sd/filescohort.asp)

+ What you'll want to do is download the most recent year (cohort16) from the website to your computer (eventually you'll just use R to do this)

+ And put it in your working directory?

+ My what?

```{r}
# this will tell you the file path of your current working directory. The best thing is to put it here, since your Rproject is here. 
getwd()

#Try to find where this is on your computer, manually.

```

---

## Read in the data, the cheating way...
+ First create a new script in R, save it, and call it something that tells you we started learning the tidyverse.

+ In the top right, right under the Environment tab, it'll say "Import Dataset"

+ The file we downloaded is a CSV file (make sure to use readr)

+ Select `Import Dataset` > `From Text (readr)` > `Browse` > Find the dataset*, select, and open > look at the preview

+ If it doesn't look right, you can play with the settings (probably have to change, delimiter)



## Don't import yet!

---

## The final steps
+ In the lower right, there is some code, copy it and cancel out

+ Paste the code into your new script; write a note about what it is

+ Eventually, you'll want to do this manually, I promise (and please promise me)

```{r echo=FALSE}
knitr::include_graphics("importing.jpg")

```

+ Run all the code...

---
## Code for Reading in 

```{r, eval=FALSE}
# Now that I've put my files in a rawdata folder in the working directory, I can do this:

# Load the library
library(readr)

cohort16 <- read_csv("RawData/cohort16.csv")
View(cohort16)



#Alternatively you can save the object location (makes life easier)

# Assign a variable with a string value of the file location.
cohortdata <- "RawData/cohort16.csv"

# Put the variable in your function, `read_delim`
cohort16 <- read_csv(cohortdata)

# Note the View(function) - Let's you see the data
#View(cohort16)
```

---
class: middle

### Can also go searching for it with a longer path (doesn't need to be in your working directory)
```{r readin}

cohort16 <- read_csv("C:/Users/katzd/Desktop/Teaching R/Extrablanl/Newproj/cohort16.csv")
```
  
---
## A Rare Best Practice

1. It is recommend that you create, in your working directory, folders just for the initial raw data (this data isn't to be altered)

2. Another folder in your working directory just for altered datasets (with computed variables, cleaned, or otherwise changed data)

3. Another folder just for statistical output and plots (or divide)

```{r echo=FALSE}
knitr::include_graphics("directory.jpg")

```

*(if you put it in your working directory, you'll see it straight away, if not, you'll have to find it)

---

# Introducing `dplyr`
[_**`dplyr`**_](https://dplyr.tidyverse.org/) is a package full of "verbs" that help us work on data. Some major verbs are

+ `select()` allows us to select or deselect columns by name

+ `filter()` allows us to filter rows by certain values

+ `mutate` allows us to create/compute new variables

---

class: middle

## Data Sense

Let's get a sense of the data
```{r}
#get variable names
names(cohort16)

```

```{r echo=FALSE}
knitr::kable(xtable::xtable(cohort16),  format = "html")

```

Get the first 10 rows
```{r eval = FALSE}
head(cohort16)

```

---
## Using select to get RID of a column
We notice that the first column in the dataset is called `X1.` This column is added automatically when a dataframe is exported to csv from R. Let's get rid of it.  

We use a `-sign` before the column name. That's it. 

```{r}
co16_rem <- select(cohort16, -X1)

#non_tidyverse solution
co16_rem <- cohort16[-1]

```

---



