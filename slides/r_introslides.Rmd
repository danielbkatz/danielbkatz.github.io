---
title: An Introduction to R
subtitle: Data Cleaning, Wrangling, Visualizing, and Everything Else with the   <code><mark>tidyverse</span></mark>
author: "Daniel Katz<br><span style = 'font-size: 70%;'> University of California, Santa Barbara<br><br> [MethodsU 2019 | Gevirtz Graduate School of Education | June 17, 2019]</span>"
date: <img src = "methodsusm.jpg"/>
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      titleSlideClass: ["left", "middle", "inverse"]
      highlightStyle: tomorrow-night-bright
      highlightLines: true
        

---

layout: true

background-image: url(methodsu.jpg), url(UC-Santa-Barbara-seal.png), 
background-position: bottom left, bottom right
background-size: 10%, 10%

---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

```{r xaringan-themer, include = FALSE}
library(xaringanthemer)
mono_light(base_color = "#151B54",
  code_highlight_color = "#c0e8f5",
  link_color = "#197b9e")
```
class: middle  


# Introduction


```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(caTools)
library(gganimate)
library(knitr)
```

+ I'm a fourth year grad student at UCSB

+ Began chipping away at learning R about four years ago

+ It was really frustrating

+ After a major project or two, it became my preferred tool for most things data analysis

+ I don't expect you to be experts after this session, but I hope you know where to start!


---

class: center, middle

### What are you hoping to get out of this course?
---

class: middle

### Teaching Philosophy/General Strategy


+ My goal is to get you up and running - doing is the best learning

+ Provide you with some quality resources for continuing to learn via links like [_**this**_](https://stackoverflow.com/tags/r/info)
  
+ I'm going with a `tidyverse` [_**first**_](http://varianceexplained.org/r/teach-tidyverse/) approach while mixing in foundations that I find unavoidable [_**Click to read more**_](http://varianceexplained.org/r/teach-tidyverse/)

+ I won't emphasize style/best practices except in a few cases

+ I think it's important to focus on ideas and functions!

+ For more on style/best practices, [_**click here**_](http://adv-r.had.co.nz/Style.html)

+ Learning how to trouble shoot is quite important

---
class: middle
## General Outline

1. Intro: What is R? How should I think about and use R and Rstudio?

--
2. Some basic data structures (unavoidable foundation)  

--
3. Data wrangling with the `tidyverse`    
  
--
4. Data exploration  

--
5. Basic modelling in R  

--
6. Other Help Resources  

---

class: middle


# What is R?

+ R is a software and scripting language

+ Like any other language it has syntax (for now think, "rules" of language)

+ R comes with a variety of built-in functions

+ R is desiged for statistics, but you can do lots with it 
  + build websites
  + write documents in Latex
  + Create slides for presentations, etc.
---
class: middle
  
# Why do I like R?

+ It is quickly becoming the statistical language of choice in academic and non-academic circles    
--
  
+ Fast developing `R Packages` are making tasks more accessible to non-programmers like us  
--
  
+ R allows for sharing code: we won't cover Github, but please [_**check it out**_](https://happygitwithr.com/rstudio-git-github.html)  
--
  
+ R forces us to slow down and think  

---

# It makes really cool data visualizations

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE, dpi = 200}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_smooth(se = FALSE) +
  theme(legend.position = "bottom") +
  guides(colour = guide_legend(nrow = 1, override.aes = list(size = 4))) +
   labs(
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    colour = "Car type"
  )
```

---
 
```{r echo=FALSE, fig.align='center', dpi = 200, message=FALSE}
ggplot(mpg, aes(x= factor(manufacturer),y=hwy))+geom_boxplot(aes(fill=manufacturer))+
theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

---

class: middle, center

## What's a Function?

---


```{r echo=FALSE, fig.align='center', out.width='90%'}
knitr::include_graphics("cyclists.gif")

```

---

# Other Forms of Functions?
$f(x)=sin(\theta)$ 

`f_angle <- sin(angle)` 
```{r makingdat, fig.align='center', message=FALSE, warning=FALSE, include=FALSE}
library(transformr)

angle <- matrix(seq(from = 1, to=20, by=.2),ncol=1)
output <- as.data.frame(sin(angle))
findat <- cbind(angle, output) %>% mutate(time1 = angle)

sinanimate <- ggplot(findat, aes(x=angle, y = V1)) + geom_line(size=.8, color="blue") + geom_point() +  labs(x="angle", y = "sin(angle)")+ transition_reveal(time1) + ease_aes('linear')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
animate(sinanimate, height = 500, width =900)
```

---
## What are some functions we use?
.pull-left[## How about a mean?
Let's say we have a vector, `x`, with five elements: `1,2,3,4,5`    

`x = [1,2,3,4,5]`

$mean(x)=\frac{1+2+3+4+5}{5}$ 

$mean(x) = 3$]

--
.pull-right[## `R` uses functions:
```{r echo=TRUE}
#Let's make a vector with 
#five elements

x <- c(1,2,3,4,5)

mean(x)
```
]
---

## There are also other forms of functions we use in computation
+ "Reading in" Data into R so we can explore or model

+ Linear Regression,`lm()` in R

+ Transforming Data in R:
```{r echo=FALSE}
knitr::include_graphics("gatheringdata.jpg")
```
From, [_**R for Data Science by Grolemund and Wickham**_](https://r4ds.had.co.nz)


---

## Open R Studio

background-image: url(introconsole.png)  
background-size: contain
background-position: center


---

background-image: url(scriptconsole.png)  
background-size: contain
background-position: center


---


class: middle


# Always Remind Yourself
  
+ The best way to learn R is to use it

+ Even when it's frustratingly slow, use R instead of something else
  
+ There are a lot of resources online to answer questions (Stack Exchange, Stack Overflow, Github)
  
+ Errors are good! Use the error output to guide your thinkingg (and Googling)

+ In other words, "failing fast" is really convenient


---

class: middle


## Introducing "Scripts"

+ Scripts are RStudio's text editor. ***Work in Scripts***. They're saved text that you *can* edit  
  

+ Code in the console doesn't get saved and you *cannot* edit  
  
--

+ The primary aim of working in scripts is reproducability, transparency, being able to run code from start-to-finish without intervening  
  
--
+ Don't rely on saving data, rely on being able to re-run your script as if you have no memory of what you had done before 

---

# Running the code in a script

```{r echo=FALSE, echo = FALSE, fig.align = "center"}
knitr::include_graphics("run script.jpg")
```

---

## Creating a new script in RStudio

.pull-left[
1. File > New File > R Script 
  + Or, ctrl+shft+N
  + Or, below file, hit the icon that looks like:
```{r echo=FALSE}
knitr::include_graphics("createscript.jpg")
```

2. To run a line of code in a script, put your cursor on that line, and run it, via ctrl/cmd + enter. Or the `run` button in the top right of the script
]

--
.pull-right[3. Type `1+1` in a script and run it.
  + What happens? Where does it output?

4. There are multiple ways to run more than one line of code at a time
  + Highlight the relevant code, run
  + Or select the various options under "Run"]

--

.center[**Challenge** Figure out how to run a line of code in the console!]

---


class: middle


## Commenting


+ Commenting is essential to workflow. You may not remember why or what you were thinking or doing when looking at old code. 

+ R will recognize any line after `#` as a comment

For instance:

```{r}
# I ran this to see what would happen

factorial(4)

```

+ I recommend taking notes in an R script this way! 
---


# Vocabulary
          
| R Word   | Translation
|----------|------------------
| Script   | Document containing code to be run
| Console  | Output Window/Printer (but you can also run code here)
| Environment| The place where things you create in R, live
| Working Directory| The folder where your current R session lives, where output files go
  
---

class: middle

## working Directory (We'll return to this in more detail later)
+ The notion of the <mark>working directory</mark> isn't unique to R

+ Directories are just folders on your computer with a certain `path`
  + For instance, your `desktop` is a directory
  + A folder within `Documents` is a directory

+ A `working directory` is just where you tell `R` that you'll be working
  + when you load files, it knows to look to a certain folder
  + When you export files, `R` exports automatically to the working directory]

---
## File paths

+ A path to a Word doc on my desktop looks like: "C:/Users/katzd/Desktop/myfile.docx".

+ A path to a file in a folder called, `thesis` in the `Documents directory` looks like "C:/Users/katzd/Documents/thesis/myfile.docx"

+ But these are long!

+ Instead, we'll tell `R` where to read files from, where to export, etc, via `projects`
---

## File Paths Continued...

+ If I make the folder `thesis` my working directory, then you won't need to type, the whole path, just the name of the document or <mark>subdirectory</mark> plus folder 

+ If I have a folder called, `analysis` in `thesis` - thesis is my working- directory the path will be "analysis/filename.ext".

+ To see the currect working directory, simply run the code `getwd()`

+ To set the working directory setwd("filepath") (the filepath has to be in quotes)

.center[###If you've made any comments or would like to save your current script, go ahead an do-so now (file > save > where you want to save it > name)]

---

## Creating RStudio Projects
### Projects are an RStudio work unit, (but, not required)

.pull-left[1. Once open, click File (top left) > New Project

2. New Directory > New Project > Create Project as a Subdirectory of: click `browse`.
  
3. Choose where you'd like to put this session's R work (for instance, on your desktop. 

4. Go to the first box, `Directory Name` > Name this R project - `IntroR` (no spaces; It'll make your life easier)

5. Create Project.]

.pull-right[
```{r, out.width = "800px", echo = FALSE, fig.align = "center"}
knitr::include_graphics("newproject.jpg")

```
]
---

class: middle

## Let's get setup for the workshop!
1. In your project, create a new script to have at the ready.
2. Save the script as `introscript`.
3. Use a command to check your working directory.
4. Write a comment that "this is the first R work we'll do in the R workshop"
5. Find the `View` tab and change your RStudio session so it shows only the console
6. Change your R studio Session to look like it did before
7. Find the `Global Environment` (what's in there right now?)


---
  
# R and Packages
+ Think of `packages` as very specialized bundles of software. 
  + They're collections of functions developed by the "community"
  + For a full intro, [_**click here**_](https://www.datacamp.com/community/tutorials/r-packages-guide#what)

+ These packages have documentation if they're on `CRAN: The Comprehensive R Archive Network` (and even sometimes if they're not)  
  
+ You don't need all the packages!

+ Packages add functions to base R

+ For instance, the `psych` package is a built with tools commonly needed in the social sciences
---
class: middle

## Packages, cont'd
+ When you `install.packages()`, R will search for a package on `CRAN` and download it to your computer

+ To see where it's downloaded, type `.libpaths()` and run this

+ Each time you start a new R session, you have to load a package via `library()` but you don't have to install, each time
---

class: middle

# Installing and Loading Packages 
Installs the package if it's not already installed:

`install.packages("psych")`

Loads the package so I can use the functions in the `psych` package"
`library(psych)`
---

class: middle 


## Installing and loading packages looks like this (note the quotes)
```{r eval=F}
install.packages("psych")  
library(psych)
```
---

class: middle

## Let's Install and Load the tidyverse

```{r eval=F}
install.packages("tidyverse")  
library(tidyverse)

```

  
---
## why the tidyverse?

The [_**tidyverse**_](https://www.tidyverse.org/packages/) is a suite of packages used to make data wrangling/cleaning, exploration, and, ultimately, modelling
  
  
```{r echo=FALSE}
packagsstab <- tibble(Package = c("dplyr", "ggplot2", "tidyr", "readr", "purrr", "tibble", "stringr", "forcats"), Description = c("for creating common, easy to use and remember verbs for basic data handling tasks", "for data visualization",  "for creating `tidy` data",  "for reading in 'rectangular' data of different formats",  "for really working with lots of data easily (for cleaning, computing variables, etc.)", "to make dealing with dataframes even easier. Dataframes will become tibbles in R", "for working with strings and doing a bit of text mining", "for handling factors in R"))

knitr::kable(xtable::xtable(packagsstab),  format = "html")
```

---


# Operators in R
|Operation|Operator in R |Example|
|---------|------|-------|-------|
|Addition |`+` |`4+3`
|Subtraction|`-`| `4-3`
|Multiplication|`*`| `4*3`
|Exponentiation | `**`| `4**3`
|Division | `/`| `12/4`
|Matrix multiplication|`%*%`| `a %*% b`|

**Aside from the matrix multiplication, make sure all of these work in `R`** (use a script!)

---

## Output
+ R `returns a value` in the `console`

+ It'll look like this:
```{r echo=FALSE}
knitr::include_graphics("output_slides.jpg")
```

***Challenge***: Order of operations: Run `(4+3)*(4-3)` and then `4+3*4-3` in the console (for experimentation). What happens?

---
## Variable Assignment
1. One of the most fundamental aspects of R (really any language) assigning `variables` or `objects`, giving something a name so you can store it and work with it in R.
  + R uses `<-` (shortcut for Windows: "alt" and "-" or in Mac: "option" and "-")

2. Now, we can store objects in R and work with the objects!

3. Note, none of this requires an external package, just through `base R`. For a nice base R cheat sheet, [_**Click**_](https://paulvanderlaken.files.wordpress.com/2017/08/base-r-cheetsheat.pdf)

--
 
For instance, run the code below:
```{r echo=TRUE}
x <- 2
```

```{r echo=TRUE}
#What's the value of y?
y <- x+2
```

1. What is in your Global Environment, now?
2. What was outputted in the console?

--
**Outputting the value of a variable requires using `print(x)`, or just `x`

---

class: middle 


## The Environment

+ In the right corner, under `Global Environment`, you should now see where R is "storing" `x` and `y` and their values.

+ The environment is also where we'll see what datasets, in R speak, `dataframes` that we have loaded or created, or other objects that we've assigned to variables


+If you don't assign something to a variable, it won't be stored
---
  

## Run the code below in a script

`x + y`

`x*y`

`x==y`

What happens?
--

```{r}
x + y

x*y

x==y
```

---
## Boolean/Logical Operators!

+ If you notice, R `x==y` yields, `FALSE`
+ `==` is a different type of operator

|Operation|Operator in R |Example|
|---------|------|-------|-------|
|Equality/Are they Equal? |`==` |`x==y`
|Not Equal |`!=` |`x!=y`
|Greater than or equal|`>=`| `x >= y`
|Less than or equal to|`<=`| `x <= y`
|Greater than|`>`| `x > y`
|Less than |`<`| `x < y`
|Or |  `|` | `x|y`
|And | `&`| `x & y`

---

## Data Structures
For individual values or vectors, R has a number of data types (not different than SPSS). We have a few ways of checking (for instance, numeric, character, factor, etc):

```{r}
# this will work on vectors as well
class(x)

is.numeric(x)
is.character(x)

isTRUE(x<2)


```
---
Class: Middle

## what's a Vector?
+ In R, it's basically anything that has more than one `element` in it.

+ It's just like a vector in math (row vector, column vector)

+ R does think in matrices

+ Instead of doing things one at a time, it operates on entire rows, columns, dataframes, lists, (arrays in general)

```{r}

v1 <- c(1, 3, 8, 9, 10**8)
v1

```

---
## Check your Understanding

Run the following code:

`v2 <- c("hello", "world", 4, 5)`

`v2`

`class(v2)`

**Challenge** 
1. What do you think `c()` does? (concat...)  

2. What <mark>`class`</mark> is `v2`?  

3. Strings, or in R speak, objects of class `character`, need to have double or single quotes around them. Any intuition as to why?  


---

## Check for Understanding

1. Run the following code:

`v3 <- c(1:5)`  
`v4 <- c(6:10)`    
`v5 <- v3+v4 `  
`v5`   

2. What does the `:` operator do?

3. what class is `newvector`?

--

```{r}
v3 <- c(1:5)
v4 <- c(6:10)
v5 <- v3+v4
v5
```

---

class: middle

### This is one of those necessary evils, so you know how R works
- To select individual elements, use `[2]` and the numeric position that you would like to extract. 

- For instance, run: `v6 <- v5[c(2,3)]`

- This is also how one may pull out individual columns, rows, or specific rows and columns in a dataframe in R using <mark>base R</mark>

- We can also get descriptives or compute across a vector, or specific vector elements

---

## How to Operate on Vectors (this is also true for dataframes)

+ Everything below are base R commands using base R functions

`sum(v5)`  
**`sum(v5[c(2,3)])`**  

`mean(v5)`  
`sd(v5)`  
`range(v5)`  
**`summary(v5)`**


```{r echo=FALSE}
sum(v5)

sum(v5[c(2,3)])

mean(v5)

sd(v5)

range(v5)

summary(v5)
```
---



