<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>An Introduction to R: Data Cleaning, Wrangling, Visualizing, and Everything Else part 2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Daniel Katz" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, my-title, title-slide

# An Introduction to R: Data Cleaning, Wrangling, Visualizing, and Everything Else part 2
### Daniel Katz

---


class: middle




# Enough Putzing about, Let's get to Data

+ The type of data structure you will most likely work with in R is the dataframe. Or, data.frame. 

+ Other common types of data structures:
  + `matrix`
  + `lists`
  + `arrays`

--
  

+ An array is a general multidimensional data structure 
  + mindblowingly, a matrix that essentially has an x, y, and a z axis (or more!)
--

+ One can make lists of matrices or dataframes, and lists can be [_**IN dataframes**_](https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html)
  + For instance, sometimes, you want to do the same thing to a number of dataframes [_**iteration**_](https://r4ds.had.co.nz/iteration.html).
  + If you put them in a list, you have a method for doing this very easily (we'll see later)
  
---

class: middle

## Getting data sets in to R with the `readr` package
+ The first challenge: getting data into R

+ R needs a command to read in the data

+ R needs a &lt;mark&gt;path&lt;/mark&gt;, where to find the data

+ We're going to use the [_**`readr`**_](https://readr.tidyverse.org/) package to handle most file types

+ However, the `foreign` package and `haven` package can handle files from SAS, SPSS, STATA (and probably others)

+ You don't need SPSS, SAS, or STATA to read data into R

---

class: middle

## First, things first
+ Download the data!

+ The data today is a publically accessible dataset from the [_**California Department of Education**_](https://www.cde.ca.gov/ds/sd/sd/filescohort.asp)

+ I've posted it on the workshop web here: [_**CDEDATA**_](http://www.dbkatz.com/1/01/01/beginning-a-new-intro-to-r-workshop/)

+ And put it in your working directory

+ My what?


```r
# this will tell you the file path of your current working directory. The best thing is to put it here, since your Rproject is here. 
getwd()
```

```
## [1] "C:/Users/katzd/Desktop/Github/perswebsite2/static/slides"
```

---
## A Rare Best Practice

1. It is recommend that you create, in your working directory, folders just for the initial raw data (this data isn't to be altered)

2. Another folder in your working directory just for altered datasets (with computed variables, cleaned, or otherwise changed data)

3. Another folder just for statistical output and plots (or divide)

&lt;img src="directory.jpg" width="1080" /&gt;

*(if you put it in your working directory, you'll see it straight away, if not, you'll have to find it)


---

## Read in the data, the cheating way...
+ First create a new script in R, save it, and call it `learning_tidyverse`.

+ In the top right, right under the Global Environment tab, it says "Import Dataset"

+ The file we downloaded is a CSV file (make sure to use readr)

+ Select `Import Dataset` &gt; `From Text (readr)` &gt; `Browse` &gt; Find the dataset*, select, and open &gt; look at the preview

+ If it doesn't look right, you can play with the settings (probably have to change, delimiter)



# Don't import yet!

---

## The final steps
+ In the lower right, there is some code, &lt;mark&gt;copy it&lt;/mark&gt; and cancel out

+ Paste the code into your new script; write a note about what it is

+ Eventually, you'll want to do this manually, I promise (and please promise me)

&lt;img src="importing.jpg" width="1609" /&gt;

+ Run all the code...

---
## Code for Reading in 


```r
# Now that I've put my files in a rawdata folder in the working directory, I can do this:

# Load the library
library(readr)

co16 &lt;- read_csv("RawData/cohort16.csv")
View(co16)



#Alternatively you can save the object location (makes life easier)

# Assign a variable with a string value of the file location.
cohortdata &lt;- "RawData/cohort16.csv"

# Put the variable in your function, `read_delim`
co16 &lt;- read_csv(cohortdata)

# Note the View(function) - Let's you see the data
#View(cohort16)
```

---
class: middle

### Can also go searching for it with a longer path (doesn't need to be in your working directory)

```r
co16 &lt;- read_csv("C:/Users/katzd/Desktop/Teaching R/Extrablanl/Newproj/RawData/cohort16.csv")
```

```
## Warning: Missing column names filled in: 'X1' [1]
```

```
## Parsed with column specification:
## cols(
##   X1 = col_double(),
##   CDS = col_character(),
##   Name = col_character(),
##   AggLevel = col_character(),
##   DFC = col_character(),
##   Subgroup = col_character(),
##   Subgrouptype = col_character(),
##   NumCohort = col_double(),
##   NumGraduates = col_double(),
##   `Cohort Graduation Rate` = col_double(),
##   NumDropouts = col_double(),
##   `Cohort Dropout Rate` = col_double(),
##   NumSpecialEducation = col_double(),
##   `Special Ed Completers Rate` = col_double(),
##   NumStillEnrolled = col_double(),
##   `Still Enrolled Rate` = col_double(),
##   NumGED = col_double(),
##   `GED Rate` = col_double(),
##   Year = col_double()
## )
```
  

---

# Introducing `dplyr`
[_**`dplyr`**_](https://dplyr.tidyverse.org/) is a package full of "verbs" that help us work on data. Some major verbs are

+ `filter()` allows us to filter rows by certain values

+ `select()` allows us to select or deselect columns by name

+ `mutate` allows us to create/compute new variables

---

## Data Sense

Let's get a sense of the data

```r
#get variable names

names(co16)
```

```
##  [1] "X1"                         "CDS"                       
##  [3] "Name"                       "AggLevel"                  
##  [5] "DFC"                        "Subgroup"                  
##  [7] "Subgrouptype"               "NumCohort"                 
##  [9] "NumGraduates"               "Cohort Graduation Rate"    
## [11] "NumDropouts"                "Cohort Dropout Rate"       
## [13] "NumSpecialEducation"        "Special Ed Completers Rate"
## [15] "NumStillEnrolled"           "Still Enrolled Rate"       
## [17] "NumGED"                     "GED Rate"                  
## [19] "Year"
```
---
Get the first 10 rows

```r
head(co16)
```

```
## # A tibble: 6 x 19
##      X1 CDS   Name  AggLevel DFC   Subgroup Subgrouptype NumCohort
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;dbl&gt;
## 1     1 3968~ Paci~ S        N     FOS      All                 NA
## 2     2 3367~ Palm~ S        N     FOS      All                 NA
## 3     3 4075~ Paso~ S        N     FOS      All                 NA
## 4     4 1964~ Path~ S        N     FOS      All                 NA
## 5     5 3367~ Patr~ S        N     FOS      All                 NA
## 6     6 4369~ Pega~ S        N     FOS      All                 NA
## # ... with 11 more variables: NumGraduates &lt;dbl&gt;, `Cohort Graduation
## #   Rate` &lt;dbl&gt;, NumDropouts &lt;dbl&gt;, `Cohort Dropout Rate` &lt;dbl&gt;,
## #   NumSpecialEducation &lt;dbl&gt;, `Special Ed Completers Rate` &lt;dbl&gt;,
## #   NumStillEnrolled &lt;dbl&gt;, `Still Enrolled Rate` &lt;dbl&gt;, NumGED &lt;dbl&gt;,
## #   `GED Rate` &lt;dbl&gt;, Year &lt;dbl&gt;
```


---
## Using select to get RID of a column
We notice that the first column in the dataset is called `X1.` This column is added automatically when a dataframe is exported to csv from R. Let's get rid of it.  

We use a `-` sign before the column name. That's it. 


```r
co16_rem &lt;- select(co16, -X1)

#non tidyverse solution (remember indexing!!)
co16_rem &lt;- co16[-1]

#make sure this worked
names(co16_rem)
```

```
##  [1] "CDS"                        "Name"                      
##  [3] "AggLevel"                   "DFC"                       
##  [5] "Subgroup"                   "Subgrouptype"              
##  [7] "NumCohort"                  "NumGraduates"              
##  [9] "Cohort Graduation Rate"     "NumDropouts"               
## [11] "Cohort Dropout Rate"        "NumSpecialEducation"       
## [13] "Special Ed Completers Rate" "NumStillEnrolled"          
## [15] "Still Enrolled Rate"        "NumGED"                    
## [17] "GED Rate"                   "Year"
```

---
## Introducing `filter()` and pipe operators `%&gt;%`

+ Let's say, we want to know about average graduation rate
  + For the entire state
  + But just for non-charter schools
  + And for standard school districts

+ I know that in the `Name` column, there's school names and a value called `Statewide`

+ `filter` literally filters rows that meet a certain rule, such as equaling a value

+ `filter(df_name, rule)`

```r
stateco16 &lt;- filter(co16_rem, Name=="Statewide")
```
---

## Piping Operators

+ However, we don't want to create a new object in R every time you perform an operation (we often perform a lot of operations and this gets confusing)

+ The `%&gt;%` operator, helps - read it as `and then`


```r
state_co16 &lt;- co16_rem %&gt;% 
  filter(Name=="Statewide")

# table gives you counts on column (remember $ indexes)
table(state_co16$Name)
```

```
## 
## Statewide 
##        35
```


---

.pull-left[1. The variable, &lt;mark&gt;DFC&lt;/mark&gt; contains information as to whether a school is a charter school or not. 
  + Y = Charter School
  + N = Not a charter school

2. The variable &lt;mark&gt;Subgroup&lt;/mark&gt; identifies totals for each school by subgroup
  + EL = English Language Learners
  + MIG = Migrant Education
  + SD = Socioeconmically Disadvantaged
  + SE = Special Education
  + FEM = Female
  + MAL = Male
  + All = Total Of All Subgroups]

.pull-right[1. Starting with the dataframe, `co16_rem`, create a new dataframe called `filtdf` by...

2. using `filter` so we only keep schools that are not charter schools and information on Socioeconomically disadvantaged students.

3. Use filter and/or pipes so you only need to create one dataframe 

3. If you need the codebook, it is here: [_**California Department of Education**_](https://www.cde.ca.gov/ds/sd/sd/filescohort.asp)

*Hint* You can do this with one pipe or two. ]

---
# Solutions


```r
# Either one will work, I prefer method1
filtdf &lt;- co16_rem %&gt;% filter(DFC == "N", Subgroup == "SD")

# or...

filtdf &lt;- co16_rem %&gt;% filter(DFC=="N") %&gt;% filter(Subgroup=="SD")

table(filtdf$DFC)
```

```
## 
##    N 
## 2846
```

```r
table(filtdf$Subgroup)
```

```
## 
##   SD 
## 2846
```
---
# Challenge
1.After filtering, what categories are still left in the variable, `Agglevel`, in your new dataframe, filtdf?

2. Without creating a new R object, edit your script such that you keep only the category `D` from `Agglevel`.

--

```r
# Get categories in Agglevel
table(filtdf$AggLevel)
```

```
## 
##    D    O    S    T 
##  492   58 2295    1
```

```r
#filter again
filtdf &lt;- co16_rem %&gt;% filter(DFC == "N", Subgroup == "SD", 
                              AggLevel=="D")

# or...

filtdf &lt;- co16_rem %&gt;% filter(DFC=="N") %&gt;% filter(Subgroup=="SD") %&gt;%
  filter(AggLevel=="D")

table(filtdf$AggLevel) #492 schools that now match this criteria...
```

```
## 
##   D 
## 492
```

```r
# Other checks: get the number of rows in a dataframe
nrow(filtdf)
```

```
## [1] 492
```

```r
ncol(filtdf)
```

```
## [1] 18
```


```r
statemfco16 &lt;- co16_rem %&gt;% 
  select(CDS, Name, AggLevel, DFC, Subgroup, Subgrouptype, NumCohort, NumGraduates) %&gt;%
  filter(Name=="Statewide")
```
---
  
Make life easier, just select the needed columns with `select(data.framename, variable names to be selected, seperated by a column)`

```r
gencohort16 &lt;- select(co16_rem, CDS, Name, AggLevel, DFC, 
                      Subgroup, Subgrouptype, NumCohort, 
                      NumGraduates)
head(gencohort16)
```

```
## # A tibble: 6 x 8
##   CDS    Name   AggLevel DFC   Subgroup Subgrouptype NumCohort NumGraduates
##   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;dbl&gt;        &lt;dbl&gt;
## 1 39686~ Pacif~ S        N     FOS      All                 NA           NA
## 2 33670~ Palm ~ S        N     FOS      All                 NA           NA
## 3 40754~ Paso ~ S        N     FOS      All                 NA           NA
## 4 19647~ Pathw~ S        N     FOS      All                 NA           NA
## 5 33670~ Patri~ S        N     FOS      All                 NA           NA
## 6 43694~ Pegas~ S        N     FOS      All                 NA           NA
```

```r
# or 
View(gencohort16)
```

Easy! 

---


## Checking our work

+ Remember when we talked about `class`?

+ Well, let's make sure `CDS` which is a school ID, is of class 'character`, how will we do this?

+ We don't want school ID to be a "numeric" variable of some sort - It's an ID so leading zeros matter

+ Using another R index tool, `$`, which selects column by name (auto complete should show you the name).

```r
class(co16_rem$CDS)
```

What about all variables?


```r
str(co16_rem)
```

+ Easy!

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "tomorrow-night-bright",
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
